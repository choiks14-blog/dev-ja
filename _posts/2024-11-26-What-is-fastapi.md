---
title: fastapiとは？
author: alpa28980
date: Tue, 26 Nov 2024 01:13:15 GMT
categories: [プログラム言語]]
tags: ["fastapi"]
comment: true
---

はじめに
--ーー

FastAPIはPythonベースのウェブフレームワークで、最新の高性能なAPI開発を可能にします。 このフレームワークは、標準的なPythonの型ヒントを利用してAPIを素早く簡単に構築することができます。

FastAPIを学び、使用する主な理由としては、以下のような特徴があります：

* 非常に高速なパフォーマンス: Node.jsやGoレベルの優れたパフォーマンスを提供します。
* 開発生産性の向上：機能開発速度を約200～300%向上させることができます。
* バグが少ない：開発者のミスによるバグを約40%削減することができます。
* 直感的で簡単な使い方：エディタサポートと自動補完機能が優れているため、デバッグ時間を短縮することができます。
* 簡潔なコード：コードの重複を最小限に抑え、パラメータ宣言で様々な機能を実装することができます。
* 強力なデータ検証: Pydantic ライブラリにより、強力なデータ検証が可能です。
* 自動対話型 API 文書化: OpenAPI 明細書を自動生成して API 文書化が容易です。

上記のような特徴により、FastAPIはPython開発者が現代的で実用的なAPIを迅速かつ生産的に開発するのに役立ちます。

FastAPIの基本的な機能 - APIの生成とルーティング
-----------------------------

FastAPIを使ってAPIを生成してルーティングする方法はとても簡単です。まず、FastAPIのインスタンスを生成します。

python

    from fastapi import FastAPI
    
    app = FastAPI()
    

次に、APIエンドポイントを定義する関数を作成します。この時、`@app.get()`, `@app.post()`などのデコレータを使ってHTTPメソッドとURLパスを指定することができます。

python

    @app.get("/")
    def read_root()：
        return {"message"："Hello, FastAPI!"}
    
    @app.get("/items/{item_id}")
    def read_item(item_id: int, q: str = None)：
        return {"item_id"：item_id, "q": q}
    

上記の例では、`"/"`パスに対するGETリクエストを処理する `read_root` 関数と、`"/items/{item_id}"`パスに対するGETリクエストを処理する `read_item` 関数を定義しています。関数のパラメータにタイプヒントを使用することで、データの検証と文書化が自動的に行われます。

FastAPIは非同期プログラミングもサポートしています。エンドポイント関数で `async` と `await` を使用することで、非同期タスクを処理することができます。

python

    @app.get("/async_items/{item_id}")
    async def read_async_item(item_id: int)：
        # 非同期操作の実行
        result = await some_async_operation(item_id)
        return {"item_id"：item_id, "result": result}
    

最後にアプリケーションを実行すると、APIサーバーが起動します。

python

    if __name__ == "__main__"：
        import uvicorn
        uvicorn.run(app, host="0.0.0.0", port=8000)
    

このようにFastAPIを使うと、Pythonのタイプヒント機能を活用してAPIを簡単かつ迅速に開発することができます。 また、非同期プログラミングをサポートすることで高いパフォーマンスを実現することができます。

FastAPIの基本機能 - データモデル定義
--------------------------

FastAPIではPydanticライブラリを使用してデータモデルを定義します。Pydanticモデルを通じてリクエスト本文のフィールドとネストされたモデル、そして追加のデータモデルを定義することができます。

例えば、Body - Fields方式で次のようにデータモデルを定義することができます。

python

    from pydantic import BaseModel
    
    クラス Item(BaseModel)：
        name: str
        description: str = None
        price: float
        tax: float = None
    

タイプヒントを使用してフィールドとタイプを宣言すると、FastAPIは自動的にデータ検証とシリアル化/デシリアライズを行います。これにより、開発者は手動で検証ロジックを作成する必要がなくなり、生産性が向上します。

データモデルは自動生成される対話型ドキュメントにも含まれているため、APIの要求/応答データ形式を簡単に把握することができます。 したがって、FastAPIでは、Pydanticを使用してデータモデルを定義し、検証とシリアル化を自動化することで、開発生産性を向上させることができます。

FastAPIの基本機能 - 自動APIドキュメントの作成
---------------------------

FastAPIはOpenAPI(Swagger)仕様に基づいて自動対話型APIドキュメントを生成します。これにより、開発者は別途の文書作業をしなくても、APIのエンドポイント、パラメータ、応答形式などを簡単に確認することができます。

FastAPIはSwagger UIとReDocの2つのシステムを提供してAPIドキュメントをレンダリングします。両システムはOpenAPIの仕様に基づいて動作し、機能は似ていますが、UIが異なります。開発者は自分の好みに合ったドキュメントシステムを選択することができます。

Swagger UIは `/docs` パスから、ReDocは `/redoc` からアクセスできます。どちらのシステムもウェブブラウザで動作し、APIのエンドポイントとパラメータを確認して直接テストすることができます。 また、ドキュメントに説明を追加することもできます。

このように、FastAPIはOpenAPI仕様を自動的に生成し、Swagger UIとReDocを通じてインタラクティブなAPIドキュメントを提供することで、開発者のドキュメント作成作業を大幅に軽減します。開発者はコードに集中するだけで、プロダクションレベルのAPIドキュメントを簡単に作成することができます。

FastAPIの基本機能 - 依存性インジェクション
-----------------------

FastAPIで依存性注入(Dependency Injection)はコードのモジュール化と柔軟性を高める重要な概念です。依存性インジェクションは、オブジェクト間の結合度を下げてコードをより簡単にメンテナンスして再使用することができます。

FastAPIでは `Depends` デコレータを使って依存関係を定義して注入することができます。例えば、データベース接続のための依存関係を次のように作成することができます。

python

    from fastapi import Depends
    from db import get_db_connection
    
    def get_db()です：
        db = get_db_connection()
        を試します：
            yield db
        最後に
            db.close()
    
    @app.get("/users")
    def get_users(db=Depends(get_db))：
        # dbオブジェクトを使ってユーザーデータ照会
        ...
    

このように `get_db` 関数を依存関係として定義すると、 `get_users` 関数からデータベース接続オブジェクトを自動的に注入されます。これにより、データベース接続ロジックを分離して再利用することができます。

依存性インジェクションの一番大きなメリットは、コードの結合度を下げてモジュール化を高めることができるという点です。 各機能別に依存性を分離することで、コードの可読性と保守性が高くなります。 また、テスト時にも、実際のオブジェクトの代わりに偽のオブジェクトをインジェクションすることで、簡単にテストすることができます。

FastAPIでは、関数パラメータだけでなく、クラスコンストラクタ、HTTPリクエストオブジェクトなどにも依存関係を注入することができます。 また、「Dependencies」デコレータを使用すると、グローバルに共有される依存関係を定義することができます。

このように、FastAPIの依存関係インジェクション機能は、コードのモジュール化と柔軟性を高め、テストを容易にします。 したがって、FastAPIでアプリケーションを開発する際には、依存関係インジェクションの概念をうまく活用することが重要です。

FastAPIの基本機能 - 非同期サポート
-----------------------

FastAPIはASGI(Asynchronous Server Gateway Interface)サーバーを使って非同期処理をサポートします。ASGIは同期式ウェブサーバーと違って、単一スレッドで同時に複数のリクエストを処理することができます。これにより、FastAPIは高い並列性と拡張性を提供することができます。

FastAPIで非同期関数は `async` キーワードと `await` 表現式を使って定義されます。例えば、次のように非同期関数を書くことができます：

python

    @app.get("/async_items/{item_id}")
    async def read_async_item(item_id: int)：
        result = await some_async_operation(item_id)
        return {"item_id"：item_id, "result": result}
    

上のコードで `read_async_item` 関数は `async` キーワードで非同期関数であることを示しています。 そして `some_async_operation` 関数の結果を待つために `await` 表現式を使用しています。こうすることで、FastAPIは他のリクエストを処理している間、現在のリクエストを待機させることができます。

ASGIとasync/awaitのサポートにより、FastAPIは高い同時性と効率的なリソース使用を提供し、パフォーマンスの高いAPIを構築することができます。 また、非同期プログラミングモデルはI/Oバウンド操作で特に有用であり、データベース操作、ファイル処理、ネットワーク要求などの操作でパフォーマンスの向上をもたらすことができます。

FastAPIのメリット
-----------

FastAPIはPython開発者に次のような主な利点を提供します：

1.開発生産性の向上：FastAPIは、直感的なAPI設計と自動文書化機能により、機能開発速度を200～300%向上させることができます。 また、Pydanticライブラリを活用してデータ検証とシリアル化を自動化することで、開発生産性を大幅に向上させます。
    
2.高い性能：FastAPIはStarletteとPydanticをベースにしてNodeJSとGoレベルの非常に高い性能を提供します。 また、非同期プログラミングをサポートし、高い同時性と効率的なリソース使用を可能にします。
    
3.データ検証とシリアライゼーションの自動化：FastAPIはPydanticライブラリを通じ、強力なデータ検証とシリアライゼーション/デシリアライゼーションを自動で行います。これにより、開発者は手動で検証ロジックを作成する必要がないため、生産性が向上し、バグも減少します。
    
4.OpenAPIとJSONスキーマをサポート：FastAPIはOpenAPI仕様とJSONスキーマを完全にサポートし、自動対話型ドキュメント生成とクライアントコード生成が可能です。これにより、API文書化作業が大幅に削減されます。
    
5.統合テストの容易性：FastAPIはテストクライアントを提供し、API統合テストを容易にします。これにより、開発・テストサイクルが短縮され、安定性が向上します。
    

このように、FastAPIは開発生産性と性能、安定性を兼ね備えた現代的なフレームワークであり、Python開発者がより効率的にAPIを開発できるように支援します。

FastAPI活用事例
-------------

FastAPIは様々な分野で活用できる強力なフレームワークです。まず、ウェブアプリケーションのバックエンド開発にFastAPIを使用することができます。直観的なAPI設計と自動文書化機能により開発生産性が向上し、優れた性能と非同期プログラミングのサポートで拡張性のあるバックエンドシステムを構築することができます。

また、FastAPIはマイクロサービスアーキテクチャーによく合います。依存性注入機能により、各マイクロサービスのモジュール化が容易になり、OpenAPI仕様をサポートすることでマイクロサービス間の通信がスムーズになります。Netflixで危機管理フレームワークであるDispatchをFastAPIで構築したのが代表的な事例です。

データAPIの構築にもFastAPIが適しています。Pydanticライブラリを通じた自動データ検証と直列化/逆直列化機能で開発生産性が向上します。 また、OpenAPIとJSONスキーマをサポートし、多様なクライアントでAPIを簡単に使用することができます。

機械学習モデルの配布時にもFastAPIを活用することができます。UberでLudwigプロジェクトのMLモデル配布のためにFastAPIを使用したことがあります。高速なパフォーマンスと非同期サポートで高いスループットを提供し、シンプルなAPIインターフェースでモデルの提供が容易になります。

最後に、FastAPIはIoTおよびセンサーデータ処理に活用することができます。非同期プログラミングモデルにより、大量のセンサーデータを効率的に処理することができ、軽量化されたAPIインターフェースでIoTデバイスとスムーズに通信することができます。

このように、FastAPIはウェブアプリケーションバックエンド、マイクロサービス、データAPI、マシンラーニングモデル配布、IoTおよびセンサーデータ処理など、様々な分野で活用度が高く、開発生産性、性能、拡張性、モジュール化など、FastAPIの利点を活かし、実際の様々なプロジェクトに適用することができます。

結論
--結論

FastAPIはPythonで開発されたモダンで高性能なウェブフレームワークで、次のような主な特徴を持っています：

1.非常に速い性能：NodeJSとGoレベルの優れた性能を提供します。
2.速い開発速度：機能開発速度を約200～300%向上させることができます。
3.少ないバグ：開発者のミスによるバグを約40%減らすことができます。
4.直感的で簡単な使い方：エディタサポートと自動補完機能が優れており、習得が容易です。
5.簡潔なコード：コードの重複を最小限に抑え、パラメータ宣言で様々な機能を実装することができます。
6.強力なドキュメント生成：OpenAPI仕様を自動的に生成し、インタラクティブなAPIドキュメントを提供します。

このように、FastAPIは開発生産性、性能、安定性、文書化など様々な面でメリットを提供し、Python開発者がより効率的にAPIを開発することができます。 実際、Microsoft、Uber、Netflixなどの有名企業でFastAPIを活用しており、開発者コミュニティでも人気が高まっています。

今後、FastAPIはさらに多様な機能が追加され、性能が向上することが期待され、Pythonウェブフレームワークのエコシステムでその地位をさらに確固たるものにすることが予想されます。FastAPIチームは、継続的なアップデートと改善を通じて、Python開発者に最新の生産的で強力なツールを提供します。

---
---

<iframe src="https://ads-partners.coupang.com/widgets.html?id=807239&template=carousel&trackingCode=AF3190673&subId=&width=680&height=140&tsource=" width="680" height="140" frameborder="0" scrolling="no" referrerpolicy="unsafe-url" browsingtopics></iframe>
해당 링크를 통해 제품 구매가 이루어진 경우 쿠팡 파트너스 활동 일환으로 인해 일정 수수료가 블로거에게 제공되고 있습니다

